<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="origin-trial"
    content="AvGcsKm3oSmzqCkwdaqoWAqhk/jl+3wOBEuPBhgzUFfiWzNP4kYKY2secBGVR7/7+23r6Ahm0u02qN5EnavG7gMAAABReyJvcmlnaW4iOiJodHRwczovL2pycHJpY2UuZ2l0aHViLmlvOjQ0MyIsImZlYXR1cmUiOiJXZWJHUFUiLCJleHBpcnkiOjE2NjM3MTgzOTl9">
  <title>WebGPU memory bandwidth benchmark</title>
</head>

<body>
  <h1>WebGPU memory bandwidth benchmark</h1>
  <script type="module" src="src/benchmark.js"></script>

  A simple memory bandwidth benchmark that executes the following statement in
  a 1D compute shader:
  <pre>  a[i] = b[i] + 1</pre>
  where <i>i</i> is the global invocation index.
  <br />
  The data is cycled through three different storage buffers, over many
  iterations.
  <br />
  Loads and stores for data types that are not supported by the target device
  are emulated using atomics.
  <br />
  <br />

  <a href="https://github.com/jrprice/webgpu-bandwidth/blob/main/src/benchmark.ts">
    <b style="font-size: 120%; color: blue">View benchmark source on GitHub.</b>
  </a>

  <hr />
  <label for="powerpref">Power preference:</label>
  <select name="powerpref" id="powerpref" style="font-size: 80%;">
    <option value="high-performance" selected="selected">high-performance</option>
    <option value="low-power">low-power</option>
  </select>
  <br />
  <label for="arraysize">Array sizes (elements):</label>
  <select name="arraysize" id="arraysize" style="font-size: 80%;">
    <option value="100000">100 million</option>
    <option value="50000">50 million</option>
    <option value="20000">20 million</option>
    <option value="10000" selected="selected">10 million</option>
    <option value="5000">5 million</option>
    <option value="2000">2 million</option>
    <option value="1000">1 million</option>
    <option value="500">500 thousand</option>
    <option value="200">200 thousand</option>
    <option value="100">100 thousand</option>
  </select>
  <br />
  <label for="wgsize">Workgroup size:</label>
  <select name="wgsize" id="wgsize" style="font-size: 80%;">
    <option value="256" selected="selected">256</option>
    <option value="128">128</option>
    <option value="64">64</option>
    <option value="32">32</option>
    <option value="16">16</option>
  </select>
  <br />
  <label for="iterations">Benchmark iterations (coalesced):</label>
  <select name="iterations" id="iterations-coalesced" style="font-size: 80%;">
    <option value="1000" selected="selected">1000</option>
    <option value="500">500</option>
    <option value="200">200</option>
    <option value="100">100</option>
    <option value="10">10</option>
  </select>
  <br />
  <label for="iterations">Benchmark iterations (random access):</label>
  <select name="iterations" id="iterations-random" style="font-size: 80%;">
    <option value="1000">1000</option>
    <option value="500">500</option>
    <option value="200">200</option>
    <option value="100">100</option>
    <option value="50" selected="selected">50</option>
    <option value="20">20</option>
    <option value="10">10</option>
  </select>
  <br />
  <br />
  <button id="run">Run</button>
  <label id="status"></label>
  <br />

  <hr />
  <pre style="font-size: 150%;">
  <table>
    <tr>
      <th style="text-align: left;">Data type&nbsp;&nbsp;</th>
      <th style="text-align: left;">Pattern&nbsp;&nbsp;&nbsp;&nbsp;</th>
      <th style="text-align: left;">Result</th>
    </tr>

    <tr>
      <td>Int32</td>
      <td>coalesced</td>
      <td id="Int32-coalesced-status"></td>
    </tr>
    <tr>
      <td>Int16</td>
      <td>coalesced</td>
      <td id="Int16-coalesced-status"></td>
    </tr>
    <tr>
      <td>Int8</td>
      <td>coalesced</td>
      <td id="Int8-coalesced-status"></td>
    </tr>

    <tr><td><br/></td></tr>

    <tr>
      <td>Int32</td>
      <td>random</td>
      <td id="Int32-random-status"></td>
    </tr>
    <tr>
      <td>Int16</td>
      <td>random</td>
      <td id="Int16-random-status"></td>
    </tr>
    <tr>
      <td>Int8</td>
      <td>random</td>
      <td id="Int8-random-status"></td>
    </tr>
  </table>
</pre>
</body>

</html>
